<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>Carrinho</title>
    <link rel="stylesheet" href="/carrinho.css">
</head>
<body>
    <h1>Seu Carrinho</h1>

    <!-- Exibe os itens do carrinho -->
    <div class="carrinho">
        <% carrinho.forEach(item => { %>
            <div class="produto">
                <h2><%= item.nome %></h2>
                <p><%= item.descricao %></p>
                <form action="/atualizar-carrinho" method="post">
                    <input type="hidden" name="idProduto" value="<%= item.idProduto %>">
                    
                    <!-- Seleção de Cor -->
                    <label for="cor">Cor:</label>
                    <select name="cor">
                        <% item.coresDisponiveis.forEach(cor => { %>
                            <option value="<%= cor.nomeCor %>"><%= cor.nomeCor %></option>
                        <% }); %>
                    </select>
                    
                    <!-- Seleção de Tamanho -->
                    <label for="tamanho">Tamanho:</label>
                    <select name="tamanho">
                        <% item.tamanhosDisponiveis.forEach(tamanho => { %>
                            <option value="<%= tamanho.tamanho %>"><%= tamanho.tamanho %></option>
                        <% }); %>
                    </select>
                    
                    <!-- Seleção de Quantidade -->
                    <label for="quantidade">Quantidade:</label>
                    <input type="number" name="quantidade" min="1" value="<%= item.quantidadeSelecionada || 1 %>">
                </form>
            </div>
        <% }); %>
    </div>

    <!-- Seleção de Endereço -->
    <h2>Endereço de Entrega</h2>
    <form action="/confirmar-compra" method="post">
        <label for="endereco">Escolha um endereço:</label>
        <select name="endereco" required>
            <% enderecos.forEach(endereco => { %>
                <option value="<%= endereco.idEndereco %>">
                    <%= endereco.rua %>, Nº <%= endereco.numero %>, Bairro: <%= endereco.bairro %> - CEP: <%= endereco.cep %>
                </option>
            <% }); %>
        </select>

        <!-- Forma de Pagamento -->
        <h2>Forma de Pagamento</h2>
        <label for="pagamento">Escolha a forma de pagamento:</label>
        <select name="pagamento" required>
            <option value="pix">PIX</option>
            <option value="cartao">Cartão de Crédito</option>
        </select>

        <!-- Exibe o código PIX ou opções de parcelamento -->
        <div id="pix-container" style="display: none;">
            <p><strong>Código PIX:</strong> <%= codigoPix %></p>
        </div>

        <div id="cartao-container" style="display: none;">
            <p><strong>Parcelas:</strong></p>
            <% parcelasCartao.forEach(parcel => { %>
                <p><%= parcel.numeroParcelas %>x de R$ <%= parcel.valorParcelado %></p>
            <% }); %>
        </div>

        <!-- Botão de Confirmar Compra -->
        <button type="submit">Confirmar Compra</button>
    </form>

    <script>
        // JavaScript para exibir opções de pagamento baseadas na escolha do usuário
        const pagamentoSelect = document.querySelector('select[name="pagamento"]');
        const pixContainer = document.getElementById('pix-container');
        const cartaoContainer = document.getElementById('cartao-container');

        pagamentoSelect.addEventListener('change', function() {
            if (this.value === 'pix') {
                pixContainer.style.display = 'block';
                cartaoContainer.style.display = 'none';
            } else if (this.value === 'cartao') {
                cartaoContainer.style.display = 'block';
                pixContainer.style.display = 'none';
            }
        });
    </script>
</body>
</html>
