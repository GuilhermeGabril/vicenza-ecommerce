<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formas de Pagamento</title>
    <link rel="stylesheet" href="/pag.css">
    <script>
        function mostrarCodigoPix() {
            document.getElementById('codigoPix').style.display = 'block';
            document.getElementById('cartoesRegistrados').style.display = 'none';
        }

        function mostrarCartoesRegistrados() {
            document.getElementById('codigoPix').style.display = 'none';
            document.getElementById('cartoesRegistrados').style.display = 'block';
        }
    </script>
</head>
<body>
    <h1>Forma de Pagamento</h1>

    <h2>Resumo do Carrinho</h2>
    <ul>
        <% carrinhoFinal.forEach(item => { %>
            <li style="display: flex; align-items: center;">
                <img src="<%= item.imagem %>" alt="Imagem do Produto" style="width: 50px; height: 50px; margin-right: 10px;">
                <div>
                    Produto: <%= item.nomeProduto %> <br>
                    Cor: <%= item.cor %> <br>
                    Tamanho: <%= item.tamanho %> <br>
                    Quantidade: <%= item.quantidade %> <br>
                    Preço: R$ <%= item.preco %> <br>
                </div>
            </li>
        <% }) %>
    </ul>

    <h3>Total da Compra: R$ <%= totalCompra %></h3>

    <form action="/concluir-compra" method="POST">
        <h3>Escolha a Forma de Pagamento:</h3>

        <!-- Seção de Endereço -->
        <h3>Escolha um Endereço:</h3>
        <select name="enderecoSelecionado" required>
            <option value="">Selecione um endereço</option>
            <% enderecos.forEach(endereco => { %>
                <option value="<%= endereco.idEndereco %>">
                    <%= endereco.rua %>, <%= endereco.numero %>, <%= endereco.bairro %>, <%= endereco.cidade %>, <%= endereco.estado %>
                </option>
            <% }) %>
        </select>

        <!-- PIX Option -->
        <label for="pix">
            <input type="radio" id="pix" name="metodoPagamento" value="pix" onclick="mostrarCodigoPix();"> PIX
        </label><br>

        <!-- Cartão Option -->
        <label for="cartao">
            <input type="radio" id="cartao" name="metodoPagamento" value="cartao" onclick="mostrarCartoesRegistrados();"> Cartão
        </label><br>

        <!-- Seção do Código PIX -->
        <div id="codigoPix" style="display:none;">
            <h4>Código PIX:</h4>
            <p><%= codigoPix %></p>
        </div>

        <!-- Seção dos Cartões Registrados -->
        <div id="cartoesRegistrados" style="display:none;">
            <h4>Seus Cartões:</h4>
            <ul>
                <% cartoes.forEach(cartao => { %>
                    <li>
                        <label>
                            <input type="radio" name="cartaoSelecionado" value="<%= cartao.idCartao %>">
                            Cartão: **** **** **** <%= cartao.numeroCartao.slice(-4) %> <br>
                            Tipo: <%= cartao.tipo %> <br>
                            Validade: <%= cartao.dataExpiracao %>
                        </label>
                    </li>
                <% }) %>
            </ul>
        </div>

        <!-- Botão para concluir a compra -->
        <button type="submit">Concluir Compra</button>
    </form>
</body>
</html>